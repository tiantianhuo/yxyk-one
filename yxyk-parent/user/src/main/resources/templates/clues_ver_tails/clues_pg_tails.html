<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>线索核查详情</title>
    <link rel="stylesheet" href="/vonder/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/vonder/bootstrap-table/bootstrap-table.min.css">
    <link rel="stylesheet" href="/vonder/jqueryStep/css/jquery.step.css">
    <link rel="stylesheet" href="/vonder/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/vonder/font_7grt4on8i7d/iconfont.css" media="all">
    <link rel="stylesheet" type="text/css" href="/vonder/iCheck/skins/all.css"/>
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/xqlabel.css"/>
    <link rel="stylesheet" href="/css/Re_clues.css"/>
    <link rel="stylesheet" href="/css/clues_ver.css"/>
    <link rel="stylesheet" href="/css/yuqing.css"/>
    <link rel="stylesheet" href="/vonder/yuyin/yuyin.css">

    <link href="/vonder/iCheck/skins/all.css" rel="stylesheet" type="text/css"/>
    <script src="/vonder/jquery-1.10.2/jquery-1.10.2.min.js"></script>
    <script src="/vonder/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="/vonder/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="/vonder/jqueryStep/js/jquery.step.min.js"></script>
    <script type="text/javascript" src="/js/jquery.imgZoom.js"></script>
    <script type="text/javascript" src="/js/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="/js/jquery.drag.js"></script>
    <script src="/vonder/layui/layui.js"></script>
    <script src="/vonder/iCheck/icheck.js"></script>
    <script type="text/javascript" src="/js/xqlabel.js"></script>
    <script type="text/javascript" src="/js/data.js"></script>

    <script type="text/javascript" src="/vonder/yuyin/weixinaudio.js"></script>
    <script type="text/javascript" src="/js/common.js"></script>

</head>
<style type="text/css">
    .btnbox  {
        text-align: center;
        margin-top: 30px;
    }

    .Notm {
        width: 96%;
        margin: 70px auto;
        font-size: 18px;
        padding-right: 33px;
    }

    /*视频*/
    .videolist {
        position: relative;
        float: left;
        width: 140px;
        height: 100px;
        margin-right: 50px;
        margin-top: 15px;
        margin-bottom: 30px;
        background: #333;
    }

    .videolist:hover {
        cursor: pointer;
    }

    .videoed {
        display: block;
        width: 50px;
        height: 50px;
        position: absolute;
        left: 35%;
        top: 25%;
        z-index: 99;
        border-radius: 100%;
        background: #333;
    }

    .videos {
        display: none;
        border: 1px solid #080808;
        position: fixed;
        left: 50%;
        top: 50%;
        margin-left: -320px;
        margin-top: -249px;
        z-index: 100;
        width: 640px;
        height: 500px;
        background: #333;
    }

    .vclose {
        position: absolute;
        right: 1%;
        top: 1%;
        border-radius: 100%;
        cursor: pointer;
    }

    /*音频*/
    .yuyin {
        margin: .1rem 0;
        color: #999999;
        height: 34px;
        max-width: 200px;
        min-width: 80px;
        background-color: #e8f8e6;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        position: relative;
    }

    /* 右侧样式 */
    .yuyin_img {
        position: absolute;
        width: 30px;
        height: 34px;
        background: url(//static.xxt.cn/nb/zx/message/img/yuyin.png);
        background-size: 115px 34px;
        background-repeat: no-repeat;
        background-position: -3px;
        animation: bofang 1s steps(1) infinite;
        -moz-animation: bofang 1s steps(1) infinite;
        -webkit-animation: bofang 1s steps(1) infinite;
        -o-animation: bofang 1s steps(1) infinite;
        animation-play-state: paused;
    }

    .yuyin_img_l {
        left: 5px;
    }

    .yuyin_img_r {
        right: 5px;
        transform: rotate(180deg);
    }

    .yuyin_txt {
        position: absolute;
        color: lightgray;
        line-height: 34px;
    }

    .yy_txt_r {
        left: 5px;
    }

    .yy_txt_l {
        right: 5px;
    }

    @keyframes bofang {
        25% {
            background-position: -33px;
        }
        50% {
            background-position: -59px;
        }
        75% {
            background-position: -84px;
        }
        100% {
            background-position: 0px;
        }
    }

    .contentright {
        float: none;
    }

    .contentss {
        padding: 0 !important;
    }
</style>
<body>
<!--头-->
<#include "../common/header.html"/>
<!--头end-->
<div class="wrapper ">
    <div class="content contentss">
        <div class="contentright cl_verleft" style="padding-top: 20px;">
            <div class="biaozhu">
                <div class="clues_verleft">
                    <div class="Re_c_ctit clearfix">
                        <div class="Re_c_ctit clearfix">
                            <span class="Re_c_ctxt">线索详情：</span>
                        </div>
                        <div class="Re_c_rmess clearfix">
                            <ul class="Re_c_rmess1 clearfix">
                                <li>
                                    <span>举报人姓名：</span>
                                    <span id="report_person_name"></span>
                                </li>
                                <li>
                                    <span>联 系 电 话：</span>
                                    <span id="phone">183****2468</span>
                                </li>
<!--                                <li class="uuid">-->
<!--                                    <span>查询码：</span>-->
<!--                                    <span id="uuid">183****2468</span>-->
<!--                                </li>-->
                            </ul>
                            <ul class="Re_c_rmess2 clearfix">
                                <li>
                                    <span>类<span style="padding-left: 3em;"></span>别：</span>
                                    <span id="modular_name"></span>
                                </li>
                                <li>
                                    <span>线索发生地：</span>
                                    <span id="address"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="Re_c_rcot clearfix">
                        <span class="Re_c_ctxt w100">问题描述：</span>
                        <p class="Re_c_cp" id="despriction" style="border:1px solid #e6e9f0;min-height:300px">

                        </p>
                        <div class="hee">
                        <div class="Re_c_rcot">

                            <span class="Re_c_ctxt w100">图片展示：</span>
                            <div class="Re_c_cimg" id="imageList"></div>
                            <span class="Re_c_ctxt w100">音频展示：</span>
                            <div class="Re_c_cimg" id="mp3list">
                                <p class="weixinAudio">
                                    <audio src="" id="media" width="1" height="1" preload></audio>
                                    <span id="audio_area" class="db audio_area">
                                    <span class="audio_wrp db">
                                    <span class="audio_play_area">
                                    <i class="icon_audio_default"></i>
                                    <i class="icon_audio_playing"></i>
                                    </span>
                                    <span id="audio_length" class="audio_length tips_global"></span>
                                    <span class="db audio_info_area">
                                    </span>
                                    <span id="audio_progress" class="progress_bar" style="width: 0%;"></span>
                                    </span>
                                    </span>
                                </p>
                            </div>
                            <span class="Re_c_ctxt w100">视频展示：</span>
                            <div class="video">
                                <div class="container" id="mp4List">
                                    <!--                                    <div class="videolist" vpath="/images/Re_clues/v1.jpg"-->
                                    <!--                                         ipath="https://blz-videos.nosdn.127.net/1/OverWatch/OVR-S03_E03_McCree_REUNION_zhCN_1080P_mb78.mp4">-->
                                    <!--                                        <img src="/images/Re_clues/v1.jpg" width="163px" height="127px"/>-->
                                    <!--                                        <img src="/images/Re_clues/play.png" class="videoed"/>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="videolist" vpath="/images/Re_clues/v2.jpg"-->
                                    <!--                                         ipath="https://blz-videos.nosdn.127.net/1/OverWatch/AnimatedShots/Overwatch_AnimatedShot_CinematicTrailer.mp4">-->
                                    <!--                                        <img src="/images/Re_clues/v2.jpg" width="163px" height="127px"/>-->
                                    <!--                                        <img src="/images/Re_clues/play.png" class="videoed"/>-->
                                    <!--                                    </div>-->
                                    <div class="videos"></div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="me">

                        </div>
                    </div>
                    <p class="arrowbox" hidden>
                        <img src="/images/Re_clues/arrow.png"/>
                        <span>查看详情</span>
                    </p>
                    <p class="arrowbox1">
                        <img src="/images/Re_clues/arrow1.png"/>
                        <span>收起详情</span>
                    </p>
                </div>
                <div class="clues_verright">
                    <div class="cl_veripbox clearfix">
                        <span class="cl_verip">线索评估</span>
                    </div>
                    <ul class="clues_verul">
                        <div class="clues_verulbox dontLook" id="pg_div">


                        </div>
                        <div class="cl_veritabox">
                            <textarea class="cl_verita dontLook" placeholder="请输入备注信息" id="remarks"
                                      class="dontLook"></textarea>
                        </div>
                        <div id="la" class="cl_btnbox">
                            <button type="button" class="dontLook" onclick="saveCase(1)">立案</button>
                            <button type="button" class="dontLook" onclick="saveCase(0)">不立案</button>
                        </div>
                        <div class="btnbox" id="las">
                            <div class="Notm">
                                <p>经审查认定，
                                    <span id="makeup">不予立案</span>
                                </p>
                            </div>
                        </div>
                    </ul>

                </div>
            </div>
        </div>
        <#include "/common/footer.html"/>
    </div>
    <@shiro.hasAnyPermissions name="10202">
    <input value="1" id="permission" type="hidden">
</@shiro.hasAnyPermissions>

<!-- 添加到分析报告模态框 -->
<!-- 添加到分析报告模态框 结束-->
</div>
</body>
</html>
<script type="text/javascript">
    $("#li_xshc").attr("class", "active");
    //如果没有权限 禁止点击内容设置
    var permission = $("#permission").val();
    if (permission != 1) {
        $(".dontLook").attr("disabled", "disabled");
        $(".dontLook").attr("readonly", "readonly");
    } else {
        $(".dontLook").removeAttr("disabled");
        $(".dontLook").removeAttr("readonly");
    }
</script>
<script>
    function fada() {
        $(".Re_c_cimg").find("img").imgZoom();
    }

    var wh = $(window).height();
    var hh = $(".navbar").height();
    var fh = $(".footer").height();
    var rh = $(".Re_c_ctit").height();
    var ch = $(".clues_verulbox").height();
    var lh = $(".clues_verright").height();
    var ah = $(".arrowbox1").height();
    var Re_ch = lh - rh - ah - 80;
    $(".clues_verulbox").css("height", ch);
    $(".clues_verright1").css("height", lh);

    $(".look").click(function () {
        $(".clues_verright1").css("display", "block");
        $(".clues_verright").css("display", "none");
    });
    $(".closebtn").click(function () {
        $(this).parents(".zhailu").remove();
    });
    $(".hidetwo").click(function () {
        $(".clues_verright").css("display", "block");
        $(".clues_verright1").css("display", "none");
    });

    /*查看收起详情*/
    $(".Re_c_rcot").css("height", Re_ch);
    $(".arrowbox").click(function () {
        $(".arrowbox").hide();
        $(".arrowbox1").show();
        $(".Re_c_rcot").css("height", Re_ch);
    })
    $(".arrowbox1").click(function () {
        $(".arrowbox1").hide();
        $(".arrowbox").show();
        $(".Re_c_rcot").css("height", "auto");
    });

    /*icheck*/
    $('input').iCheck({
        checkboxClass: 'icheckbox_minimal-blue',
        radioClass: 'iradio_minimal-blue',
        increaseArea: '20%' // optional
    });

    /*鼠标抬起和取消事件*/
    $('.Re_c_rcot').mouseup(function (e) {
        var txt = window.getSelection ? window.getSelection() : document.selection.createRange().text;
        var w = window.getSelection().focusOffset;
        var xx = e.originalEvent.x || e.originalEvent.layerX || 0;
        var yy = e.originalEvent.y || e.originalEvent.layerY || 0;
        var wh = $(window).height();
        var alerth = $('.alertbox').height();
        var cw = $('.Re_c_rcot').outerWidth() + 20;
        if (xx + 150 > cw) {
            $(".alertbox").css({"top": yy + 'px', "left": (xx - 150) + 'px', "display": "block"});
        } else if (yy < (wh - alerth)) {
            $('.alertbox').css("top", yy);
            $('.alertbox').css("left", xx);
            $('.alertbox').css("display", "block");
        } else {
            $('.alertbox').css("top", yy - alerth);
            $('.alertbox').css("left", xx);
            $('.alertbox').css("display", "block");
        }

        var nowSelect = window.getSelection();
        static_text = nowSelect.toString();
        if (static_text == null || static_text.length == 0) {
            $(".alertbox").hide();
            return false;
        }
        $(".add_close").click(function () {
            $(".alertbox").hide();
            return false;
        })


    });


    $(".excerpt").click(function () {
        $(this).parents(".alertbox").hide();
        $(".clues_verright1").css("display", "block");
        $(".clues_verright").css("display", "none");
    });


    $(document).on("click", ".addimg", function () {
        $(".addform").append($(".addclone:hidden").clone().show());
    });
    $(document).on("click", ".jianimg", function () {
        $(this).parents(".addtab").remove();
    });


    /*关闭模态框*/
    $(".closeimg").click(function () {
        $("#addset").modal('hide');  //手动关闭
    });


    function close1() {
        var v = document.getElementById('video');//获取视频节点
        $('.videos').hide();//点击关闭按钮关闭暂停视频
        v.pause();
        $('.videos').html();
    }

    $(function () {
        var dshiqi = null;

        //录音播放
        $(".askinput").on("click", ".r_yuyin", function () {
            //先暂停其他的
            $(this).parent(".add_yuyin").siblings().find("audio")[0].pause();
            $(this).parent(".add_yuyin").siblings().find("s").removeClass("bofang");
            var audio = $(this).find("audio")[0],
                time = $(this).data("time");
            if (audio.paused) {
                audio.play(); //audio.play();// 这个就是播放
                $(this).find("s").addClass("bofang");
                dshiqi = setTimeout(function () { //dshiqi是外层定义好的一个变量！
                    $(this).find("s").removeClass("bofang"); //播放完毕去除动画
                }, time * 1000)
            } else {
                audio.pause(); // 这个就是暂停
                $(this).find("s").removeClass("bofang");
                clearTimeout(dshiqi);
            }
        });


        if ($(".askinput").children().length > 1) {
            $(".tijaobtn").removeAttr("disabled");
        } else {
            $(".tijaobtn").attr("class", "disabled");
        }

        $(".askinput").on("touchstart", ".deleteicon", function () {
            $(".tip_zhezhao").show();
            $(".g_dialog").show();
        });
        $("#g_delete").on("touchstart", function () {
            $(".tip_zhezhao").hide();
            $(".g_dialog").hide();
            $("#addluyin").show();
            $("#luyin_operate").hide();
        });

        //关闭录音弹层
        $(".bottom_op").on("touchstart", ".closebtn", function () {
            $(".luyin_dialog").hide();
        });

        //弹出录音弹层
        $("#addluyin").on("touchstart", function () {
            $(".luyin_dialog").show();
        });

        //录制完毕按钮操作data-start=0未开始录制，弹出提示，data-start=1录制完毕，回填
        $(".bottom_op").on("touchstart", ".finishbtn", function () {
            var status = $(this).data("start");
            if (status == 0) {
                $(".tip_dialog").show();
                setTimeout(function () {
                    $(".tip_dialog").hide()
                }, 3000)
            } else {
                //录音结束之后状态操作
                $("#addluyin").hide();
                //录音秒数回填，此处后面再写
                $("#luyin_operate").show();
                //录音窗口关闭
                $(".luyin_dialog").hide();
            }
        });

        //录制按钮点击
        $(".lz_operate").on("touchstart", function () {
            $(this).children("s").addClass("l_start");
            $(this).children("span").html("点击结束");
            $(this).prev(".closebtn").hide();
            $(this).next(".finishbtn").hide();
            $(".topstatus").children(".start").show();
            $(".topstatus").children(".notbegin").hide();
        })


    });

    initData();

    function initData() {

        $.post("/thread/reportDetails", {
            reportId: getUrlParam("id")
        }, function (result) {
            if (result.success) {
                $("#report_person_name").text(result.data.reportUserName);
                $("#phone").text(result.data.phone);
                $("#modular_name").text(result.data.modularName);
                $("#address").text(result.data.addressName);
                $("#despriction").text(result.data.description);
                 if(result.data.transactionState==3){
                     if(result.data.registerState==0){
                         $("#la").hide();
                         $("#makeup").text("不予立案")
                         $('input[type=checkbox]').iCheck('disable');
                     }else {
                         $("#la").hide();
                         $("#makeup").text("已立案")
                         $('input[type=checkbox]').iCheck('disable');
                     }
                 }else {
                     $("#las").hide();
                 }
                 if(result.data.type==0){
                   $(".hee").hide();
                   // $("#uuid").text(result.data.uuId)
                 }else {
                     // $(".uuid").hide();
                     var mp3Str = "";
                     $.each(result.data.mp3Url, function (i, obj) {
                         mp3Str += "<p class=\"weixinAudio" + i + "\">\n" +
                             "                        <audio src=\"\" id=\"media" + i + "\" width=\"1\" height=\"1\" preload></audio>\n" +
                             "                    <span id=\"audio_area" + i + "\" class=\"db audio_area\">\n" +
                             "                        <span class=\"audio_wrp db\">\n" +
                             "                        <span class=\"audio_play_area\">\n" +
                             "                        <i class=\"icon_audio_default\"></i>\n" +
                             "                        <i class=\"icon_audio_playing\"></i>\n" +
                             "                        </span>\n" +
                             "                        <span id=\"audio_length" + i + "\" class=\"audio_length tips_global\"></span>\n" +
                             "                        <span class=\"db audio_info_area\">\n" +
                             "                        </span>\n" +
                             "                        <span id=\"audio_progress" + i + "\" class=\"progress_bar\" style=\"width: 0%;\"></span>\n" +
                             "                        </span>\n" +
                             "                        </span>\n" +
                             "                        </p>"

                     });
                     $("#mp3list").html(mp3Str);
                     for (var i = 0; i < result.data.mp3Url.length; i++) {
                         $('.weixinAudio' + i).weixinAudio({
                             autoplay: false,
                             src: result.data.mp3Url[i].src
                         }, i);
                     }

                     var optionStr = "";
                     $.each(result.data.imageUrls, function (i, obj) {
                         optionStr += "<img onclick='fada()' src=\"" + obj + "\" draggable=\"true\">"
                     });
                     $("#imageList").html(optionStr);
                     var mp4Url = "";
                     $.each(result.data.mp4Url, function (i, obj) {
                         mp4Url += '<div class="videolist" vpath=""\n' +
                             '                                         ipath="' + obj + '">\n' +
                             '                                        \n' +
                             '                                        <img src="/images/Re_clues/play.png" class="videoed"/>\n' +
                             '                                    </div>';
                     });
                     $("#mp4List").html(mp4Url + '<div class="videos"></div>');
                     initVideos();
                 }



            }
        })
    }

    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return r[2];
        return "";
    }


    function initVideos() {
        //	视频播放
        $('.videolist').each(function () { //遍历视频列表
            $(this).hover(function () { //鼠标移上来后显示播放按钮
                $(this).find('.videoed').show();
            }, function () {
                $(this).find('.videoed').hide();
            });
            $(this).click(function () { //这个视频被点击后执行
                var img = $(this).attr('vpath');//获取视频预览图
                var video = $(this).attr('ipath');//获取视频路径
                $('.videos').html("<video id=\"video\" poster='" + img + "' style='width: 100%;height: 100%' src='" + video + "' preload=\"auto\" controls=\"controls\" autoplay=\"autoplay\"></video><img onClick=\"close1()\" class=\"vclose\" src=\"/images/Re_clues/gb.png\" width=\"25\" height=\"25\"/>");
                $('.videos').show();
            });
        });
    }

    getDetail();

    function getDetail() {
        $.post("/thread/group", function (result) {
            var optionStr = "";
            if (result.success) {
                $.each(result.data, function (i, obj) {
                    optionStr += "<li>" + (i + 1) + "." + obj.name;
                    $.each(obj.rows, function (j, obb) {
                        optionStr += "<p><input type=\"checkbox\" value='" + obb.id + "'/><span>" + obb.name + "</span></p>"
                    });
                    optionStr += "</li>"
                });
            }
            $("#pg_div").html(optionStr);

            $('input').iCheck({
                checkboxClass: 'icheckbox_minimal-blue',
                radioClass: 'iradio_minimal-blue',
                increaseArea: '20%' // optional
            });

            findAssess();
        })
    }


    function findAssess() {
        $.post("/thread/findAssessByReportId", {
            reportId: getUrlParam("id")
        }, function (result) {
            if (result.success) {
                $.each(result.data.reportAssessIds, function (i, obj) {
                    $("input[value='" + obj + "']").iCheck("check");
                });
            }
        })
    }

    function saveCase(type) {
        var remarkText = $("#remarks").val();
        var idList = "";
        $("input[type='checkbox']:checked").each(function (i, obj) {
            idList += ($(obj).val()) + ",";
        });

        $.post("/thread/saveCase", {
            idList: idList,
            content: remarkText,
            type: type,
            id: getUrlParam("id")
        }, function (result) {
            if (result.success) {
                console.log(result.data);
                window.location.href = "/PopularOpinion/department"
            }
        });
    }


</script>