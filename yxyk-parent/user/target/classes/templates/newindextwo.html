<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>数据统计</title>
    <link rel="stylesheet" href="../static/vonder/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/vonder/bootstrap-table/bootstrap-table.min.css">
    <link rel="stylesheet" href="../static/vonder/jqueryStep/css/jquery.step.css">
    <link rel="stylesheet" href="../static/vonder/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../static/vonder/font_7grt4on8i7d/iconfont.css" media="all">
    <link rel="stylesheet" href="../static/css/common.css"/>
    <link rel="stylesheet" href="../static/css/newindex.css"/>
    <link rel="stylesheet" href="../static/css/bootstrap-dialog.min.css"/>
    <link rel="stylesheet" href="../static/vonder/iCheck/skins/all.css">
    <link rel="stylesheet" href="../static/css/build.css">
    <script src="../static/vonder/jquery-1.10.2/jquery-1.10.2.min.js"></script>
    <script src="../static/vonder/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="../static/js/bootstrap-dialog.min.js"></script>
    <script src="../static/vonder/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../static/vonder/jqueryStep/js/jquery.step.min.js"></script>
    <script src="../static/js/echarts.min.js"></script>
    <script src="../static/vonder/layui/layui.js"></script>
    <script type="text/javascript" src="../static/js/trend.js"></script>
    <script type="text/javascript" src="../static/js/data.js"></script>
    <script type="text/javascript" src="../static/vonder/iCheck/icheck.js"></script>
    <script type="text/javascript" src="../static/js/common.js"></script>
    <!--&lt;!&ndash;bootstrap CheckBox美化&ndash;&gt;-->
    <!--<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
    <!--<link rel="stylesheet" type="text/css" href="../static/css/build.css"/>-->

    <style type="text/css">
        .contentleft {
            overflow: auto;
        }

        .layui-collapse {
            border: none;
        }

        .layui-colla-title {
            background: none;
        }

        .activeitem {
            color: #fff;
            background: #0096fe;
        }

        .layui-colla-content  {
            padding-top: 0px !important;
        }

        #map {
            width: 400px;
            height: 300px;
            border: 1px solid #333;
        }

        .applybox {
            width: 60%;
            height: 440px;
            background: #f4f6f8;
            border-radius: 10px;
            border: 1px dashed #e6e9f0;
            margin: 0 auto;
            margin-top: 120px;
        }

        .applytop {
            width: 100%;
            height: auto;
            overflow: hidden;
            text-align: center;
            margin-top: 50px;
        }

        .applycenter {
            width: 100%;
            height: auto;
            overflow: hidden;
            text-align: center;
            font-family: '微软雅黑';
            font-size: 16px;
            color: #464e5a;
            line-height: 30px;
            margin-top: 50px;
        }

        .applybottom {
            width: 100%;
            height: auto;
            overflow: hidden;
            text-align: center;
            margin-top: 50px;
        }

        .applybtn {
            font-family: '微软雅黑';
            font-size: 16px;
            color: #fff;
            text-align: center;
            padding: 10px 24px;
            border-radius: 10px;
            border: 1px solid #3299fe;
            background: #3299fe;
        }

        .modal-body {
            margin-top: 20px;
        }

        .modal-footer {
            margin-top: 10px;
        }

        .diss {
            background: #C6C6C6;
            color: #F0F0EE;
            cursor: not-allowed !important;
        }
    </style>
</head>

<body>
<!--头-->

<#include "/common/header.html"/>
<script>
    $("#li_sjtj").addClass('active')
</script>
<!--头end-->
<div class="wrapper ">
    <div class="content">
        <div class="contentleft" style="width:16%;">
            <div class="layui-collapse" lay-accordion="">
                <div class="layui-colla-item" id="tree_content">
                    <!--<h2 class="layui-colla-title active">山西省人民检察院</h2>-->
                    <!--<div class="layui-colla-content layui-show">-->
                    <!--<div class="layui-collapse" lay-accordion="">-->
                    <!--<div class="layui-colla-item">-->
                    <!--<h2 class="layui-colla-title">太原市人民检察院</h2>-->
                    <!--<div class="layui-colla-content">-->
                    <!--<div class="layui-collapse" lay-accordion="">-->
                    <!--<div class="layui-colla-item">-->
                    <!--<h2 class="layui-colla-title">万柏林区人民检察院</h2>-->
                    <!--</div>-->
                    <!--<div class="layui-colla-item">-->
                    <!--<h2 class="layui-colla-title">迎泽区人民检察院</h2>-->
                    <!--</div>-->
                    <!--<div class="layui-colla-item">-->
                    <!--<h2 class="layui-colla-title">杏花岭区人民检察院</h2>-->
                    <!--</div>-->
                    <!--<div class="layui-colla-item">-->
                    <!--<h2 class="layui-colla-title">小店区区人民检察院</h2>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
        <div class="contentright contentrighttwo" style="width:84%;">
            <!--有权限页面开始-->
            <div class="one">
                <div class="choice">
                    <span class="title">数据统计</span>
                    <div class="layui-inline" style="float: right;">
                        <span id="xjjcy"><input id="checkbox1" class="minimal" type="checkbox" checked>是否统计下级单位数据&nbsp;&nbsp;&nbsp;&nbsp;</span>
                        <label class="timelab">时间</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input layinput" id="test6"
                                   placeholder="2019-02-19 - 2019-03-11">
                        </div>
                    </div>
                </div>
                <!--内容-->
                <div class="trendcontent">
                    <ul class="sixclass" id="modularContent">
                        <!--<li class="sixli">-->
                        <!--<div class="sixleft">-->
                        <!--<img src="../static/images/newindex/1.png" alt=""/>-->
                        <!--</div>-->
                        <!--<div class="sixright">-->
                        <!--<span class="sixtitle">生态和资源保护</span>-->
                        <!--<p class="sixnum">30</p>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--<li class="sixli">-->
                        <!--<div class="sixleft">-->
                        <!--<img src="../static/images/newindex/3.png" alt=""/>-->
                        <!--</div>-->
                        <!--<div class="sixright">-->
                        <!--<span class="sixtitle">食药安全</span>-->
                        <!--<p class="sixnum">30</p>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--<li class="sixli">-->
                        <!--<div class="sixleft">-->
                        <!--<img src="../static/images/newindex/2.png" alt=""/>-->
                        <!--</div>-->
                        <!--<div class="sixright">-->
                        <!--<span class="sixtitle">国有财产保护</span>-->
                        <!--<p class="sixnum">30</p>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--<li class="sixli">-->
                        <!--<div class="sixleft">-->
                        <!--<img src="../static/images/newindex/4.png" alt=""/>-->
                        <!--</div>-->
                        <!--<div class="sixright">-->
                        <!--<span class="sixtitle">国有土地使用权出让</span>-->
                        <!--<p class="sixnum">30</p>-->

                        <!--</div>-->
                        <!--</li>-->
                        <!--<li class="sixli">-->
                        <!--<div class="sixleft">-->
                        <!--<img src="../static/images/newindex/5.png" alt=""/>-->
                        <!--</div>-->
                        <!--<div class="sixright">-->
                        <!--<span class="sixtitle">英烈保护</span>-->
                        <!--<p class="sixnum">30</p>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--<li class="sixli" style="margin:0;">-->
                        <!--<div class="sixleft">-->
                        <!--<img src="../static/images/newindex/6.png" alt=""/>-->
                        <!--</div>-->
                        <!--<div class="sixright">-->
                        <!--<span class="sixtitle">其他</span>-->
                        <!--<p class="sixnum">30</p>-->
                        <!--</div>-->
                        <!--</li>-->
                    </ul>
                    <!--内容左边-->
                    <div class="leftbox" style="width:32%;float: left;margin-right: 2%;">
                        <div class=""
                             style="margin-top: 0;padding:30px;padding-top: 20px;padding-bottom:10px;border:1px solid #e6e9f0;">
                            <div class="trendtitle">
                                <div class="fang"></div>
                                <span class='titles'>线索统计</span>
                            </div>
                            <div id="main3"></div>
                        </div>

                        <div class="trendleft" style="padding-right: 10px;">
                            <div class="trendtitle">
                                <div class="fang"></div>
                                <span class='titles'>线索分布</span>
                            </div>
                            <div id="map"></div>
                        </div>
                    </div>

                    <!--内容右边-->
                    <div class="rightbox" style='width:66%;height: auto;overflow: hidden;'>
                        <ul class="trendbuttom">
                            <li class="trendbuttomli first">
                                <div class="trendtitle">
                                    <div class="fang"></div>
                                    <span class='titles'>线索成案率</span>
                                </div>
                                <div id="main2"></div>
                            </li>
                            <li class="trendbuttomli">
                                <div class="trendtitle">
                                    <div class="fang"></div>
                                    <span class='titles'>举报回复</span>
                                </div>
                                <div id="main4"></div>
                            </li>
                        </ul>
                        <div class="trendtop">
                            <div class="trendtitle">
                                <div class="fang"></div>
                                <span class='titles'>趋势总览</span>
                            </div>
                            <div id="main1"></div>
                        </div>

                    </div>
                </div>
                <!--内容结束-->
            </div>
            <!--有权限页面结束-->
            <!-- 无权限页面开始-->
            <div class="two" hidden>
                <div class="applybox">
                    <div class="applytop">
                        <img src="../static/images/newindex/null.png" alt=""/>
                    </div>
                    <div class="applycenter">
                        <p>抱歉~您暂无该查看该检察院数据统计的权限</p>
                        <p>可以提交申请，申请通过后可以查看</p>
                    </div>
                    <div class="applybottom">
                        <button class="applybtn" type="button" id="btn_parent" onclick="modals()">提交申请(<span
                                id="seconds">0</span>秒)
                        </button>
                    </div>
                </div>
            </div>
            <!-- 无权限页面结束-->
        </div>
        <#include "/common/footer.html"/>
    </div>
</div>
</body>

</html>

<script>
    // 激活 iCheck
    $('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
        checkboxClass: 'icheckbox_minimal-blue',
        radioClass: 'iradio_minimal-blue'
    });
    $(".sixli").click(function () {
        window.location.href = "PopularOpinion/networklist.html";
    })
    $(".ditu").click(function () {
        window.location.href = "index.html"
    })
    $(".trend").click(function () {
        window.location.href = "trend.html"
    })

    // 模态框
    function modals() {
        var procuratorateId = $("h2[class='layui-colla-title activeitem']").attr("data_id");
        var procuratorName = $("h2[class='layui-colla-title activeitem']").text();
        BootstrapDialog.show({
            title: '提示',
            message: $('<span class="twos">您申请查看<span>' + procuratorName + '</span>数据统计，确定申请吗？</span>'),
            onshow: function (dialog) {
            },
            buttons: [{
                label: '提交申请',
                action: function (dialogItself) {
                    dialogItself.close();
                    $.ajax({
                        url: '/message/saveApply',
                        type: 'post',
                        data: {
                            sendUserId: procuratorateId
                        },
                        success: function (res) {
                            setTimeCookie($("h2[class='layui-colla-title activeitem']").attr("data_id"));
                            initCookie($("h2[class='layui-colla-title activeitem']").attr("data_id"));
                            initSeconds();

                            layui.use('layer', function () {
                                var layer = layui.layer;
                                layer.ready(function () {
                                    layer.msg("操作成功");
                                })
                            })
                        }
                    })
                }
            }, {
                label: '考虑一下',
                action: function (dialogItself) {
                    dialogItself.close();
                }
            }]
        });
    }


    function initCookie(id) {
        $.post("/apis/user/findByLoginUserId", function (result) {
            var dateValue = getCookie("user_time_" + result.data + "_" + id);
            if (dateValue !== '') {
                var date = new Date();
                console.log(dateValue > date);
                if (dateValue >= date) {
                    $("#btn_parent").html('提交申请(<span id="seconds">60</span>秒)');
                    $("#btn_parent").attr("disabled", "disabled");
                    $("#btn_parent").attr("class", "applybtn diss");
                    $("#seconds").text(((dateValue - date) / 1000).toFixed(0));
                    initSeconds();
                } else {
                    $("#btn_parent").removeAttr("disabled");
                    $("#btn_parent").attr("class", "applybtn");
                    $("#seconds").parent().html('提交申请');
                }
            } else {
                $("#btn_parent").removeAttr("disabled");
                $("#btn_parent").attr("class", "applybtn");
                $("#btn_parent").html('提交申请');
            }
        })
    }

    function initSeconds() {
        if ($("#seconds").text() != "0") {
            $("#seconds").text(Number($("#seconds").text()) - 1);
            setTimeout(initSeconds, 1000);
        } else {
            $("#btn_parent").removeAttr("disabled");
            $("#btn_parent").attr("class", "applybtn");
            $("#seconds").parent().html('提交申请');
        }
    }


    function setTimeCookie(id) {
        $.post("/apis/user/findByLoginUserId", function (result) {
            if (result.success) {
                console.log("当前登录用户的id" + result.data);
                setCookie("user_time_" + result.data + "_" + id, Number(new Date()) + 60 * 1000);
            }
        })
    }

    //设置cookie
    function setCookie(name, value, day) {
        var date = new Date();
        date.setDate(date.getDate() + day);
        document.cookie = name + '=' + value + ';expires=' + date;
    }

    //获取cookie
    function getCookie(name) {
        var reg = RegExp(name + '=([^;]+)');
        var arr = document.cookie.match(reg);
        if (arr) {
            return arr[1];
        } else {
            return '';
        }
    }

    var myChart1 = echarts.init(document.getElementById('main1'));
    var myChart2 = echarts.init(document.getElementById('main2'));
    var myChart3 = echarts.init(document.getElementById('main3'));
    var myChart4 = echarts.init(document.getElementById('main4'));
    //var myChart5 = echarts.init(document.getElementById('main5'));


    /*myChart4.setOption(option4);*/

    /*时间插件*/
    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //日期范围
        laydate.render({
            elem: '#test6',
            range: true,
            value: fun_date(-7),
            isInitValue: true,
            btns: ['confirm'],
            done: function (value, date, endDate) {
                console.log(value);
                $("#test6").val(value);
                getCountForEveryModular();
                getDataForFilingState();
                getDataForReplyState();
                getEveryProcuratorateCount();
                getEveryDayClueCount();
            }
        });
    });
    $(function () {
        $("#test6").val(fun_date(-7));
        initData()
        console.log("检察院id:" + $("h2[class='layui-colla-title activeitem']").attr("data_id"))
        getCountForEveryModular();
        getDataForFilingState();
        getDataForReplyState();
        getEveryProcuratorateCount();
        getEveryDayClueCount();

    })
    imgArr = [
        '../static/images/newindex/3.png',
        '../static/images/newindex/2.png',
        '../static/images/newindex/1.png',
        '../static/images/newindex/4.png',
        '../static/images/newindex/5.png',
        '../static/images/newindex/6.png'
    ]

    //按模块统计
    function getCountForEveryModular() {
        var procuratorateId = $("h2[class='layui-colla-title activeitem']").attr("data_id");
        var time = $("#test6").val();
        var startTime = time.substr(0, 10) + " 00:00:00";
        var endTIme = time.substr(13, 24) + " 23:59:59";
        console.log(startTime)
        console.log(endTIme)
        var isAllProcuratorate = $('.minimal').is(':checked')
        console.log(isAllProcuratorate)
        $.ajax({
            url: '/dataAnalysis/getEveryModularCount',
            type: 'post',
            data: {
                startTime: startTime,
                endTIme: endTIme,
                isAllProcuratorate: isAllProcuratorate,
                procuratorateId: procuratorateId
            },
            success: function (res) {
                var str = "";
                var data = res.data;
                var modularName = [];
                var countData = [];
                $(data).each(function (index, obj) {
                    if (index < 5) {
                        str += '<li class="sixli"  modular="' + obj.id + '">\n' +
                            '                        <div class="sixleft">\n' +
                            '                            <img src="' + imgArr[index] + '" alt=""/>\n' +
                            '                        </div>\n' +
                            '                        <div class="sixright">\n' +
                            '                            <span class="sixtitle">' + obj.modularName + '</span>\n' +
                            '                            <p class="sixnum">' + obj.count + '</p>\n' +
                            '                        </div>\n' +
                            '                    </li>';
                    } else {
                        str += '<li class="sixli" style="margin:0;" modular="' + obj.id + '">\n' +
                            '                        <div class="sixleft">\n' +
                            '                            <img src="' + imgArr[index] + '" alt=""/>\n' +
                            '                        </div>\n' +
                            '                        <div class="sixright">\n' +
                            '                            <span class="sixtitle">' + obj.modularName + '</span>\n' +
                            '                            <p class="sixnum">' + obj.count + '</p>\n' +
                            '                        </div>\n' +
                            '                    </li>';
                    }

                    modularName.push(obj.modularName)
                    countData.push(obj.count)
                })
                $("#modularContent").html(str)
                //柱状图
                option3 = {
                    color: ['#3398DB'],
                    tooltip: {
                        // trigger: 'axis',
                        axisPointer: { // 坐标轴指示器，坐标轴触发有效
                            type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                        }
                    },

                    grid: {
                        top: '20px',
                        left: '10px',
                        right: '10px',
                        bottom: '0px',
                        containLabel: true
                    },
                    xAxis: [{
                        type: 'category',
                        data: modularName,
                        splitLine: {
                            show: false
                        },
                        splitArea: {
                            show: false
                        },
                        axisTick: {
                            alignWithLabel: true
                        },
                        axisLine: {
                            lineStyle: {
                                type: 'solid',
                                color: '#e7e8eb',
                                width: '1'
                            }
                        },
                        axisLabel: {
                            nterval: 0,
                            textStyle: {
                                color: '#868e9a'
                            },
                            formatter: function (params) {
                                //                     return value.split("").join("\n");
                                var newParamsName = ""; // 最终拼接成的字符串

                                var paramsNameNumber = params.length; // 实际标签的个数

                                var provideNumber = 4; // 每行能显示的字的个数

                                var rowNumber = Math.ceil(paramsNameNumber / provideNumber); // 计算行数，向上取整
                                //判断是否需要换行

                                if (paramsNameNumber > provideNumber) {　　　　 //循环得到每行的显示内容，p代表行

                                    for (var p = 0; p < rowNumber; p++) {
                                        var tempStr = ""; // 表示每一次截取的字符串

                                        var start = p * provideNumber; // 开始截取的位置

                                        var end = start + provideNumber; // 结束截取的位置

                                        if (p == rowNumber - 1) {　　　　　　　　 // 最后一次不换行

                                            tempStr = params.substring(start, paramsNameNumber);
                                        } else {　　　　　　　　 // 每一次拼接字符串并换行

                                            tempStr = params.substring(start, end) + "\n";
                                        }
                                        newParamsName += tempStr; // 最终拼成的字符串

                                    }
                                } else {　　　　 // 将旧标签的值赋给新标签

                                    newParamsName = params;
                                }
                                return newParamsName

                            }
                        }

                    }],
                    yAxis: [{
                        type: 'value',
                        min: '0',
                        max: '60',
                        interval: 15,
                        splitLine: {
                            show: true
                        },
                        splitArea: {
                            show: false
                        },
                        axisLine: {
                            lineStyle: {
                                type: 'solid',
                                color: '#e7e8eb',
                                width: '2'
                            }
                        },
                        axisLabel: {
                            textStyle: {
                                color: '#868e9a'
                            }
                        }
                    }],
                    series: [{
                        name: '直接访问',
                        type: 'bar',
                        itemStyle: {

                            normal: {

                                //好，这里就是重头戏了，定义一个list，然后根据所以取得不同的值，这样就实现了，

                                color: function (params) {

                                    var colorList = ['#3398DB', '#3398DB', '#3398DB', '#3398DB', '#3398DB', '#3398DB', '#3398DB'];

                                    return colorList[params.dataIndex]

                                },

                                //以下为是否显示，显示位置和显示格式的设置了

                                label: {

                                    show: true,

                                    position: 'top',

                                    formatter: '{c}'
                                }

                            }

                        },
                        barWidth: '20%',
                        data: countData
                    }]
                };
                myChart3.setOption(option3);
            }
        })
    }

    //线索成案率
    function getDataForFilingState() {
        var procuratorateId = $("h2[class='layui-colla-title activeitem']").attr("data_id");
        var time = $("#test6").val();
        var startTime = time.substr(0, 10) + " 00:00:00";
        var endTIme = time.substr(13, 24) + " 23:59:59";
        console.log(startTime)
        console.log(endTIme)
        var isAllProcuratorate = $('.minimal').is(':checked')
        $.ajax({
            url: '/dataAnalysis/getDataForFilingState',
            type: 'post',
            data: {
                startTime: startTime,
                endTIme: endTIme,
                isAllProcuratorate: isAllProcuratorate,
                procuratorateId: procuratorateId
            },
            success: function (res) {
                var name = res.data.name;
                var count = res.data.count;
                var arr = []
                $(name).each(function (index, obj) {
                    var data = {
                        value: count[index],
                        name: obj
                    }
                    arr.push(data)
                })
                //线索成案率 饼状图
                option2 = {
                    tooltip: {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'vertical',
                        x: 'right',
                        data: name
                    },
                    color: ['#0096fe', '#ffd469', '#01d8e4', '#8bd36f', '#00b7ff'],
                    series: [{
                        name: '线索成案率',
                        type: 'pie',
                        radius: '80%',
                        center: ['50%', '50%'],
                        data: arr,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            },
                            normal: {
                                label: {
                                    show: true,
                                    formatter: " {b} \n {d}% "
                                }
                            }
                        }
                    }]
                };
                myChart2.setOption(option2);
            }
        })

    }

    //线索回复率
    function getDataForReplyState() {
        var procuratorateId = $("h2[class='layui-colla-title activeitem']").attr("data_id");
        var time = $("#test6").val();
        var startTime = time.substr(0, 10) + " 00:00:00";
        var endTIme = time.substr(13, 24) + " 23:59:59";
        console.log(startTime)
        console.log(endTIme)
        var isAllProcuratorate = $('.minimal').is(':checked')
        $.ajax({
            url: '/dataAnalysis/getDataForReplyState',
            type: 'post',
            data: {
                startTime: startTime,
                endTIme: endTIme,
                isAllProcuratorate: isAllProcuratorate,
                procuratorateId: procuratorateId
            },
            success: function (res) {
                var name = res.data.name;
                var count = res.data.count;
                var arr = []
                $(name).each(function (index, obj) {
                    var data = {
                        value: count[index],
                        name: obj
                    }
                    arr.push(data)
                })
                //举报回复 饼状图
                option4 = {
                    tooltip: {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'vertical',
                        x: 'right',
                        data: name
                    },
                    color: ['#0096fe', '#ffd469', '#01d8e4', '#8bd36f', '#00b7ff'],
                    series: [{
                        name: '举报回复',
                        type: 'pie',
                        radius: '80%',
                        center: ['50%', '50%'],
                        data: arr,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            },
                            normal: {
                                label: {
                                    show: true,
                                    formatter: " {b} \n {d}% "
                                }
                            }
                        }
                    }]
                };
                myChart4.setOption(option4);
            }
        })
    }

    //线索分布
    function getEveryProcuratorateCount() {
        var procuratorateId = $("h2[class='layui-colla-title activeitem']").attr("data_id");
        var time = $("#test6").val();
        var startTime = time.substr(0, 10) + " 00:00:00";
        var endTIme = time.substr(13, 24) + " 23:59:59";
        console.log(startTime)
        console.log(endTIme)
        var isAllProcuratorate = $('.minimal').is(':checked')
        $.ajax({
            url: '/dataAnalysis/getEveryProcuratorateCount',
            type: 'post',
            data: {
                startTime: startTime,
                endTIme: endTIme,
                isAllProcuratorate: isAllProcuratorate,
                procuratorateId: procuratorateId
            },
            success: function (res) {
                var name = []
                var arr = []
                $(res.data).each(function (index, obj) {
                    name.push(obj.cityName);
                    var data = {
                        value: obj.count,
                        name: obj.cityName
                    }
                    arr.push(data)
                })
                //线索分布 饼状图
                // JSON
                $.getJSON('../static/json/shanxi.json', function (data) {
                    echarts.registerMap('shanxi', data);
                    var chart5 = echarts.init(document.getElementById('map'));
                    var option = {
                        backgroundColor: '#f5f6f8',
                        title: {
                            text: '山西省舆情展示',
                            x: 'center',
                            y: '10',
                            textStyle: {
                                color: '#000',
                                fontSize: 14
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: function (params) {
                                return params.name + ' : ' + params.value[2];
                            },
                            extraCssText: "height:30px;",

                        },
                        legend: {
                            orient: 'vertical',
                            y: 'bottom',
                            x: 'right',
                            data: ['舆情'],
                            textStyle: {
                                color: '#333'
                            }
                        },
                        visualMap: {
                            min: 0,
                            max: 5,
                            calculable: true,
                            inRange: {
                                color: ['#50a3ba', '#eac736', '#d94e5d']
                            },
                            textStyle: {
                                color: '#fff'
                            }
                        },
                        geo: {
                            map: 'shanxi',
                            roam: true,
                            aspectScale: 1,
                            label: {
                                emphasis: {
                                    show: true,
                                    color: "#fff"

                                }
                            },
                            itemStyle: {
                                normal: {
                                    areaColor: 'rgba(176,223,255,1)',
                                    borderColor: '#3e74a9'
                                },
                                emphasis: {
                                    areaColor: '#3299fe'
                                }
                            }
                        },
                        series: [
                            {
                                name: 'pm2.5',
                                type: 'effectScatter',
                                coordinateSystem: 'geo',
                                data: convertData(geoCoordMap, arr).slice(0, 4),
                                symbolSize: 5,
                                label: {
                                    normal: {
                                        show: false
                                    },
                                    emphasis: {
                                        show: false
                                    }
                                },
                                itemStyle: {
                                    emphasis: {
                                        borderColor: '#fff',
                                        borderWidth: 1
                                    }
                                }
                            },
                            {
                                name: 'pm2.5',
                                type: 'scatter',
                                coordinateSystem: 'geo',
                                data: convertData(geoCoordMap, arr).slice(4, 8),
                                symbolSize: 5,
                                label: {
                                    normal: {
                                        show: false
                                    },
                                    emphasis: {
                                        show: false
                                    }
                                },
                                itemStyle: {
                                    emphasis: {
                                        borderColor: '#fff',
                                        borderWidth: 1
                                    }
                                }
                            },
                            { //没有visualMap的情况，同颜色大小标识不同的等级
                                name: 'pm2.5',
                                type: 'scatter',
                                coordinateSystem: 'geo',
                                data: convertData(geoCoordMap, arr).slice(8, 12),
                                symbolSize: function (val) {
                                    return val[2] / 10;
                                },
                                label: {
                                    normal: {
                                        formatter: '{b}',
                                        position: 'right',
                                        show: false
                                    },
                                    emphasis: {
                                        show: true
                                    }
                                },
                                itemStyle: {
                                    normal: {
                                        color: '#ddb926'
                                    }
                                }
                            },
                            {
                                name: 'pm2.5',
                                type: 'effectScatter',
                                coordinateSystem: 'geo',
                                data: convertData(geoCoordMap, arr).slice(12, 18),
                                symbolSize: function (val) {
                                    return val[2] / 10;
                                },
                                showEffectOn: 'emphasis',
                                rippleEffect: {
                                    brushType: 'stroke'
                                },
                                hoverAnimation: true,
                                label: {
                                    normal: {
                                        formatter: '{b}',
                                        position: 'right',
                                        show: true
                                    }
                                },
                                itemStyle: {
                                    normal: {
                                        color: '#f4e925',
                                        shadowBlur: 10,
                                        shadowColor: '#333'
                                    }
                                },
                                zlevel: 1
                            },
                        ]
                    };

                    chart5.setOption(option);
                });
            }
        })
    }

    //趋势总览
    function getEveryDayClueCount() {
        var procuratorateId = $("h2[class='layui-colla-title activeitem']").attr("data_id");
        var time = $("#test6").val();
        var startTime = time.substr(0, 10);
        var endTIme = time.substr(13, 24);
        console.log(startTime)
        console.log(endTIme)
        var isAllProcuratorate = $('.minimal').is(':checked')
        $.ajax({
            url: '/dataAnalysis/getEveryDayClueCount',
            type: 'post',
            data: {
                startTime: startTime,
                endTIme: endTIme,
                isAllProcuratorate: isAllProcuratorate,
                procuratorateId: procuratorateId
            },
            success: function (res) {
                console.log(res)
                var data = res.data.data;
                var date = res.data.date;
                console.log(data);
                console.log(date);
                //折线图
                option = {
                    tooltip: {
                        trigger: 'axis',
                    },
                    grid: {
                        left: '3%',
                        top: '8%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            // 数据区域缩放
                            dataZoom: {
                                yAxisIndex: 'none'
                            },
                            restore: {},
                            saveAsImage: {}
                        }
                    },

                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: date
                    },
                    yAxis: [{
                        type: 'value',
                        min: 0,
                        max: 60,
                        interval: 15,
                        splitLine: {
                            show: false
                        },
                    },

                    ],

                    // 数据区域缩放
                    dataZoom: [{
                        type: 'inside',
                        start: 0,
                        end: 60
                    }, {
                        start: 0,
                        end: 100,
                        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                        handleSize: '70%',
                        handleStyle: {
                            color: '#fff',
                            shadowBlur: 3,
                            shadowColor: 'rgba(0, 0, 0, 0.6)',
                            shadowOffsetX: 5,
                            shadowOffsetY: 5
                        }
                    }],
                    series: [{
                        name: '随手拍',
                        type: 'line',
                        data: data,
                        itemStyle: {
                            color: '#58aef3'
                        }
                    }
                    ]

                };
                myChart1.setOption(option);
            }
        })
    }

    /*aa是减多少天或者加多少天*/
    function fun_date(aa) {
        var date1 = new Date();
        var time1 = '';
        if (date1.getMonth() + 1 < 10 && date1.getDate() < 10) {
            time1 = date1.getFullYear() + '-' + '0' + (date1.getMonth() + 1) + '-' + '0' + date1.getDate(); //time1表示当前时间
        } else if (date1.getMonth() + 1 < 10 && date1.getDate() >= 10) {
            time1 = date1.getFullYear() + '-' + '0' + (date1.getMonth() + 1) + '-' + date1.getDate(); //time1表示当前时间
        } else if (date1.getMonth() + 1 >= 10 && date1.getDate() < 10) {
            time1 = date1.getFullYear() + '-' + (date1.getMonth() + 1) + '-' + '0' + date1.getDate(); //time1表示当前时间
        } else {
            time1 = date1.getFullYear() + '-' + (date1.getMonth() + 1) + '-' + date1.getDate(); //time1表示当前时间
        }
        var date2 = new Date(time1);
        date2.setDate(date1.getDate() + aa);
        var time2 = '';
        if (date2.getMonth() + 1 < 10 && date2.getDate() < 10) {
            time2 = date2.getFullYear() + '-' + '0' + (date2.getMonth() + 1) + '-' + '0' + date2.getDate(); //time1表示当前时间
        } else if (date2.getMonth() + 1 < 10 && date2.getDate() >= 10) {
            time2 = date2.getFullYear() + '-' + '0' + (date2.getMonth() + 1) + '-' + date2.getDate(); //time1表示当前时间
        } else if (date2.getMonth() + 1 >= 10 && date2.getDate() < 10) {
            time2 = date2.getFullYear() + '-' + (date2.getMonth() + 1) + '-' + '0' + date2.getDate(); //time1表示当前时间
        } else {
            time2 = date2.getFullYear() + '-' + (date2.getMonth() + 1) + '-' + date2.getDate(); //time1表示当前时间
        }
        // time1 结束时间
        // time2 开始时间
        return time2 + ' - ' + time1;
    }

    $('.minimal').on('ifChanged', function (event) {
        if ($(this).is(':checked')) {
            getCountForEveryModular();
            getDataForFilingState();
            getDataForReplyState();
            getEveryProcuratorateCount();
            getEveryDayClueCount();
        } else {
            getCountForEveryModular();
            getDataForFilingState();
            getDataForReplyState();
            getEveryProcuratorateCount();
            getEveryDayClueCount();
        }
    });

    function initData() {
        $.ajax({
            url: '/apis/procuratorate/findProcuratorate',
            type: 'post',
            async: false,
            success: function (result) {
                if (result.success) {
                    if (result.data === null || result.data.childrenList.length === 0) {
                        $(".contentleft").hide();
                        $(".contentright").css('width', '100%');
                        $("#xjjcy").hide();
                        $("#checkbox1").hide();
                    }
                    if(result.data.childrenList.length!=0){
                        initCookie(result.data.childrenList[0].id);
                    }
                    var str = initTree(result.data);
                    $("#tree_content").html(str);
                    initLayUi();
                    $("#tree_content").find('h2').first().addClass("activeitem");
                }
            }
        });
    }

    function initTree(item) {
        var str = "";
        if (item.name !== "") {
            if (item.childrenList.length != 0) {
                str += '<h2 class="layui-colla-title"  data_id="' + item.id + '">' + item.name + '<i class="layui-icon layui-colla-icon"></i></h2>';
                str += "<div class=\"layui-colla-content layui-show\"><div class=\"layui-collapse\" lay-accordion=\"\">";
                $.each(item.childrenList, function (i, obj) {
                    str += "<div class=\"layui-colla-item\" >";
                    str += initTree(obj);
                    str += "</div>";
                });
                str += "</div>";
            } else {
                str += '<h2 class="layui-colla-title"  data_id="' + item.id + '">' + item.name + '</h2>';
                //str += "<div class=\"layui-colla-content layui-show\"><div class=\"layui-collapse\" ></div>";
            }
        }

        return str;
    }

    function initLayUi() {
        $(".layui-colla-title").click(function () {
            $('.activeitem').each(function (i, obj) {
                $(obj).removeClass("activeitem");
            });
            $(this).addClass('activeitem');
            $.ajax({
                url: '/dataAnalysis/getPermission',
                type: 'post',
                data: {
                    procuratorateId: $("h2[class='layui-colla-title activeitem']").attr("data_id")
                },
                success: function (res) {
                    if (res.data) {
                        getCountForEveryModular();
                        getDataForFilingState();
                        getDataForReplyState();
                        getEveryProcuratorateCount();
                        getEveryDayClueCount();
                        $('.two').hide();
                        $('.one').show();
                    } else {
                        $('.one').hide();
                        $('.two').show();
                    }
                }
            });
            initCookie($("h2[class='layui-colla-title activeitem']").attr("data_id"));
        });
        layui.use(['element', 'layer'], function () {
            var element = layui.element;
            var layer = layui.layer;
            //监听折叠
            element.on('collapse(test)', function (data) {
                layer.msg('展开状态：' + data.show);
            });
            removeI();
        });
    }

    /**
     * 子集去除箭头
     */
    function removeI() {

        $(".layui-colla-item").each(function (index, obj) {
            if ($(obj).find('div').length == 0) {
                $(obj).find('i').eq(0).remove();
            }
        })
    }

    var geoCoordMap = { //这里放你打点的坐标信息，虚拟信息
        '太原市': [112.53, 37.87],
        '大同市': [113.30, 40.08],
        '朔州市': [112.43, 39.33],
        '忻州市': [112.73, 38.42],
        '吕梁市': [111.13, 37.52],
        '阳泉市': [113.57, 37.85],
        '晋中市': [112.75, 37.68],
        '长治市': [113.12, 36.20],
        '临汾市': [111.52, 36.08],
        '晋城市': [112.83, 35.50],
        '运城市': [110.98, 35.02],
    };
    var convertData = function (geoCoordMap, data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var geoCoord = geoCoordMap[data[i].name];
            if (geoCoord) {
                res.push({
                    name: data[i].name,
                    value: geoCoord.concat(data[i].value)
                });
            }
        }
        return res;
    };


</script>