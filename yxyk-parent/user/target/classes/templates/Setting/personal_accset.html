<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>账号设置</title>
    <link rel="stylesheet" href="/vonder/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/vonder/bootstrap-table/bootstrap-table.min.css">
    <link rel="stylesheet" href="/vonder/jqueryStep/css/jquery.step.css">
    <link rel="stylesheet" href="/vonder/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/vonder/iCheck/skins/all.css"/>
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/configure.css"/>
    <link rel="stylesheet" href="/css/personaltwo.css"/>
    <!--bootstrap CheckBox美化-->
    <link rel="stylesheet" type="text/css" href="/css/buisld.css" />
    <script src="/vonder/jquery-1.10.2/jquery-1.10.2.min.js"></script>
    <script src="/vonder/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="/vonder/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="/vonder/layui/layui.js"></script>
    <script src="/vonder/iCheck/icheck.js"></script>
    <script type="text/javascript" src="/js/commonss.js"></script>
    <script src="/js/service/allowState.js" type="text/javascript"></script>
    <style>
        .pp_rights{
            /*line-height: 44px;*/
            margin-top:10px;
            font-size: 14px;
        }
        .pp_rights input[type=radio]{
            width: auto !important;
            height: auto !important;
        }
        .pp_rights div{
            float: left;
            margin-right: 20px;
        }
        .radio{
            margin:0 !important;
        }
    </style>
</head>
<body>
<!--头-->
<#include "../common/header.html"/>
<!--头end-->

<div class="wrapper ">
    <div class="content">
        <div class="content-right">
            <div class="cookie">
                    当前位置：
                    <span><a href="">个人中心</a></span>
                    -
                    <span><a href="">账号设置</a></span>
                </div>
                <div class="person_pass">
<!--     内容开始-->
<!--    选项卡开始-->
    <ul id="myTab" class="nav nav-tabs nav-my-style " style="padding-left: 27px;">
        <li class="tab0 active">
            <a href="#tab0" data-toggle="tab" aria-expanded="false">
                <p class="message1"></p>
                <span>修改密码</span>
            </a>
        </li>
        <#if adminState==true>
        <li class="tab1">
            <a href="#tab1" data-toggle="tab" aria-expanded="true">
                <p class="message2"></p>
                <span>数据统计</span>
            </a>
        </li>
        </#if>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade active in" id="tab0">
                        <div class="person_chagepass">
<!--                            <div class="titles">修改密码</div>-->
                            <div class="person_fillin clearfix">
                                <div class="pp_left pp_pass">原密码</div>
                                <div class="pp_right">
                                    <input type="password" id="password" placeholder="请输入原始密码"/>
                                </div>
                            </div>
                            <div class="person_fillin clearfix">
                                <div class="pp_left pp_pass">新密码</div>
                                <div class="pp_right">
                                    <input type="password" id="newPassword" placeholder="请输入新密码"/>
                                </div>
                            </div>
                            <div class="person_fillin clearfix">
                                <div class="pp_left pp_pass">再次输入</div>
                                <div class="pp_right">
                                    <input type="password" id="twoPassword" placeholder="请再次输入新密码"/>
                                </div>
                            </div>
                            <div class="person_fillin clearfix">
                                <div class="pp_left pp_pass">主页设置</div>
                                <div class="pp_right pp_rights">
                                    <@shiro.hasAnyPermissions name="10101">
                                    <div class="radio radio-info radio-inline">
                                        <input type="radio" id="inlineRadio1" value="/PopularOpinion/networklist" name="iCheck" checked>
                                        <label for="inlineRadio1"> 线索管理</label>
                                    </div>

                                </@shiro.hasAnyPermissions>
                                <@shiro.hasAnyPermissions name="10201">
                                <div class="radio radio-info radio-inline">
                                    <input type="radio" id="inlineRadio2" value="/PopularOpinion/department" name="iCheck" checked>
                                    <label for="inlineRadio2"> 线索核查</label>
                                </div>
                            </@shiro.hasAnyPermissions>
                            <@shiro.hasAnyPermissions name="10301">
                            <div class="radio radio-info radio-inline">
                                <input type="radio" id="inlineRadio3" value="/index" name="iCheck" checked>
                                <label for="inlineRadio3"> 数据统计</label>
                            </div>
                        </@shiro.hasAnyPermissions>
                        <div class="radio radio-info radio-inline">
                            <input type="radio" id="inlineRadio4" value="/office/workindex" name="iCheck" checked>
                            <label for="inlineRadio4">办公应用</label>
                        </div>
                    </div>
                </div>
                    <div class="pp_btnbox">
                        <button class="pp_btn" onclick="updatePassword()">保存</button>
                    </div>
            </div>
        </div>
        <div class="tab-pane fade" id="tab1">
            <div class="person_chagepass">
<!--                <div class="titles">数据统计</div>-->
                <div class="person_fillin clearfix">
                    <div class="pp_left pp_pass w20">是否允许上级查看</div>
                    <div class="pp_right pp_rights w80">
                        <div class="radio radio-info radio-inline">
                            <input type="radio" id="inlineRadio5" value="1" name="iChecks" checked>
                            <label for="inlineRadio5">是</label>
                        </div>
                        <div class="radio radio-info radio-inline">
                            <input type="radio" id="inlineRadio6" value="0" name="iChecks">
                            <label for="inlineRadio6"> 否</label>
                        </div>
                    </div>
                </div>
                <div class="person_fillin clearfix">
                    <div class="pp_left pp_pass w20">有效查看时间</div>
                    <div class="pp_right w80">
                        <div class="layui-input-inline" style="margin-right: 20px">
                            <input type="text" class="layui-input layinput" id="test6"
                                   placeholder="请选择一个时间段">
                        </div>
                        <input type="checkbox" id="forever">永久
                    </div>
                </div>
                <div class="pp_btnbox">
                    <button class="pp_btn pp_btntwo" onclick="updateAllowState()">保存</button>
                </div>
            </div>
        </div>
    </div>
<!--    选项卡结束-->
    <!--     内容结束-->
            <input type="hidden" value="${homeUrl}" id="orgHomeUrl">
        </div>
    </div>
<#include "/common/footer.html"/>
    </div>
</div>

</body>
<script>
    layui.use('layer', function () {
        layer = layui.layer;
    });

    $(function () {
        var type=getUrlParam("type");
        if(type!==undefined&&type==1){
            $('#myTab li:eq(1) a').tab('show')
        }
        var orgHome = $("#orgHomeUrl").val();
        if (orgHome != "none") {
            $("input[name='iCheck'][value='" + orgHome + "']").iCheck('check');
        }
        initForm();
    });
    /*修改密码*/
    function updatePassword() {
        var password = $("#password").val();
        var newPassword = $("#newPassword").val();
        if (newPassword != $("#twoPassword").val()) {
            return  layer.msg("两次输入的密码不一致");

        }
        var homeUrl = $("input[name='iCheck']:checked").val();
        if (homeUrl == undefined) {
            return layer.msg("请对首页设置进行勾选！");
        }

        $.post("/apis/user/updatePassword", {password: password, newPassword: newPassword,homeUrl:homeUrl}, function (result) {
            if (result.success) {
                layer.msg("修改成功，3秒后将重新登陆！", {
                    time: 3000,//显示的时间为3秒
                    end: function () {
                        window.location.href="../login";
                    }
                });
            } else {
                layer.msg(result.msg);
            }
        })
    }

    /*时间插件*/
    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //日期范围
        laydate.render({
            elem: '#test6',
            range: true
        });
    });

    $('input').iCheck({
        checkboxClass: 'icheckbox_minimal-blue',
        radioClass: 'iradio_minimal-blue',
        increaseArea: '20%' // optional
    });


</script>
</html>
