<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>文章管理</title>
    <link rel="stylesheet" href="/vonder/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/vonder/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet" href="/vonder/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/vonder/font_7grt4on8i7d/iconfont.css" media="all">
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/model.css"/>
    <link rel="stylesheet" href="/css/zone.css"/>
    <link rel="stylesheet" href="/css/delete.css"/>
    <link rel="stylesheet" href="/css/customer.css"/>

    <script src="/vonder/jquery-1.10.2/jquery-1.10.2.min.js"></script>
    <script src="/vonder/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="/vonder/layui/layui.js"></script>
    <script type="text/javascript" src="/js/common.js"></script>

    <!--城市三级联动-->
    <link rel="stylesheet" type="text/css" href="/vonder/select-select/css/index.css"/>
    <script src="/vonder/select-select/js/citydata.min.js"></script>
    <script src="/vonder/select-select/js/cityPicker-2.0.3.js"></script>

    <script src="/vonder/bootstrap-table/bootstrap-table.js"></script>
    <script src="/vonder/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
</head>

<body>
<!--头-->
<#include "../common/header.html"/>
<div class="wrapper ">
    <div class="content">
        <!--左侧开始-->
        <#include "../common/menu.html"/>
        <!--右侧开始-->
        <div class="content-right">
            <!--地域管理——内容-->
            <div>
                <ul class="customer-ul">
                    <li>banner</li>
                </ul>
                <div class="second-tab">
                    <div class="show-title">
                        <div class="input-box">
                            <span>筛选：</span>
                        </div>
                        <div class="input-box">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="text" class="layui-input" id="test1"
                                           placeholder="请选择发布时间">
                                    <img src="/images/img/data.png"/>
                                </div>
                            </div>
                        </div>
                        <div class="input-box img-box">
                            <input type="text" placeholder="请输入名称筛选" class="layui-input " id="input_text"
                                   onblur="initTable()"/>
                            <img src="/images/img/search.png" alt=""/>
                        </div>
                        <button class="btn found" data-toggle="modal" data-target="#add" value=""
                                onclick="">新建
                        </button>
                        <table class="p-table" id="article_table">
                        </table>
                    </div>
                </div>
            </div>
            <div id="demo" class="demo"></div>
        </div>

    </div>
</div>
<#include "../common/footer.html"/>
</div>
</body>
</html>
<script>
    var deleteId;

    $("#li_khzh").attr("class", "actives");
    $(".add").click(function () {
        window.location.href = "ArticleDetail";
    });
    $(".edit").click(function () {
        window.location.href = "ArticleDetail";
    });


    //日期范围
    layui.use('laydate', function () {
        var laydate = layui.laydate;
        //日期范围
        laydate.render({
            elem: '#test1',
            range: "~",
            done: function (value) {
                $("#test1").val(value);
                initTable();
            }
        });
        laydate.render({
            elem: '#test2',
            range: "~"
        });
    });


    initTable();

    function initTable() {

        var startTime = "";
        var endTime = "";

        if ($("#test1").val() !== "") {
            startTime = $("#test1").val().split("~")[0];
            endTime = $("#test1").val().split("~")[1];
        }

        $("#article_table").bootstrapTable('destroy');

        var keyword = $("#input_text").val();
        $("#article_table").bootstrapTable({
            url: "/apis/article/findAllArticle",
            method: "post",
            contentType: "application/json",
            ajax: undefined,
            sidePagination: "server",
            queryParams: function (params) {
                return {
                    pageNum: params.offset,
                    pageSize: params.limit,
                    startTime: startTime,
                    endTime: endTime,
                    keyword: keyword,
                    pid: 0
                };
            },
            toolbar: '#toolbar',
            striped: false,
            cache: false,
            pagination: true,
            sortable: false,
            sortOrder: "desc",
            pageNumber: 1,
            pageSize: 10,
            pageList: [10, 20],
            onClickRow: function (row, $element) {
            },
            responseHandler: function (res) {
                return res.data;
            },
            columns: [{
                field: 'id',
                title: '序号'
            }, {
                field: 'title',
                title: '标题'
            }
                , {
                    field: 'channelName',
                    title: '所在栏目'
                }, {
                field: 'createTime',
                title: '创建时间'
            }
                , {
                    field: 'createPerson',
                    title: '创建人'
                }
                , {
                    field: 'updateTime',
                    title: '修改时间'
                }
                , {
                    field: 'updatePersn',
                    title: '修改人'
                }, {
                    title: '操作内容',
                    formatter: function (value, row) {
                        return '<span data-toggle="modal" data-target="#add" onclick="updateCompany(' + row.id + ')">修改</span><span data-toggle="modal" data-target="#delete" onclick="deleteCompany(' + row.id + ')">删除</span>';
                    }
                }]
        });
    }

    function deleteCompany(id) {
        deleteId = id;
    }

    function deleteById() {
        $.post("/apis/article/delArticle", {
            id: deleteId
        }, function (result) {
            if (result.success) {
                initTable();
            }
        })
    }

    function updateCompany(id) {
        window.location.href = "/accountDetail?id=" + id;
    }
</script>