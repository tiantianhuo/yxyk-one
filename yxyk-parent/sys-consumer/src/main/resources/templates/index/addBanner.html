<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>banner设置</title>
		<link rel="stylesheet" href="../../static/vonder/bootstrap-3.3.7-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="../../static/vonder/bootstrap-table/bootstrap-table.min.css">
		<link rel="stylesheet" href="../../static/vonder/jqueryStep/css/jquery.step.css">
		<link rel="stylesheet" href="../../static/vonder/layui/css/layui.css" media="all">
		<link rel="stylesheet" href="../../static/vonder/font_7grt4on8i7d/iconfont.css" media="all">
		<link rel="stylesheet" href="../../static/css/common.css" />

		<script src="../../static/vonder/jquery-1.10.2/jquery-1.10.2.min.js"></script>
		<script src="../../static/vonder/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
		<script src="../../static/vonder/bootstrap-table/bootstrap-table.min.js"></script>
		<script src="../../static/vonder/layui/layui.js"></script>


		<!--gonggao-->
		<link rel="stylesheet" href="../../static/css/commonss.css" />
		<link rel="stylesheet" href="../../static/css/models.css" />
		<link rel="stylesheet" href="../../static/css/index-index.css" />
		<link rel="stylesheet" href="../../static/css/banner.css" />

		<!--bootstrap CheckBox美化-->
<!--		<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
		<link rel="stylesheet" type="text/css" href="../../static/css/build.css" />
        <!-- 图片-->
        <script src="../../static/js/jquery.imgZoom.js"></script>

		<!--富文本-->
		<script src="../../static/vonder/ueditor/ueditor.config.js"></script>
		<script src="../../static/vonder/ueditor/ueditor.all.min.js"></script>
        <script src="../../static/vonder/ueditor/ueditor.all.js"></script>
		<script src="../../static/vonder/ueditor/lang/zh-cn/zh-cn.js"></script>
        <script type="text/javascript" src="../../static/js/commonss.js"></script>
        <script src="../../static/vonder/ueditor/xiumi-ue-dialog-v5.js"></script>

        <style type="text/css">
            .edui-default .edui-dialog{
                top: 70px;
            }
            .edui-button.edui-for-xiumi-connect .edui-button-wrap .edui-button-body .edui-icon {
                background-image: url("http://xiumi.us/connect/ue/xiumi-connect-icon.png") !important;
                background-size: contain;
            }
            .edui-default .edui-editor-iframeholder{
                height: 300px !important;
            }
        </style>
	</head>

	<body>
		<!--头-->
        <#include "../common/header.html"/>
        <script>
            $("#li_bgyy").addClass('active')
        </script>
		<!--头end-->
		<div class="wrapper">
			<div class="content content-index">
				<!--右侧开始-->
				<div class="content-right">
					<!--内容-->
					<div>
						<ul class="customer-ul customer-uls">
							<li>当前位置：首页设置-添加banner图</li>
						</ul>
						<div class="customer-box">
							<div class="fromboxs">
								<div class="from-left">
									名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：
								</div>
								<div class="from-right">
									<input type="text" placeholder="请输入轮播图名称" id="name" class="names"/>
								</div>
							</div>
							<div class="fromboxs img-fromboxs">
								<div class="from-left">
									图&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;片：
								</div>
								<div class="from-right">
									<div class="layui-upload">
										<img src="../../static/imgbox/img/upload.png" id="test2" />
										<div class="layui-upload-list" id="demo2"></div>
									</div>
								</div>
							</div>
							<div>
								<div class="boxs-left ">
									<div class="fromboxs boxs">
										<div class="from-left">
											链&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;接：
										</div>
										<div class="from-right">
											<div class="radio radio-info radio-inline">
												<input type="radio" id="inlineRadio1" value="1" name="radioInline" checked>
												<label for="inlineRadio1"> 开启</label>
											</div>
											<div class="radio radio-info radio-inline">
												<input type="radio" id="inlineRadio2" value="0" name="radioInline">
												<label for="inlineRadio1"> 关闭</label>
											</div>
										</div>
									</div>
									<div class="fromboxs">
										<div class="from-left">
											文章标题：
										</div>
										<div class="from-right">
											<input type="text" placeholder="请填写文章标题" id="book" />
										</div>
									</div>
									<div class="fromboxs">
										<div class="from-left">
											发&nbsp;&nbsp;布&nbsp;&nbsp;人：
										</div>
										<div class="from-right">
											<input type="text" placeholder="请填写发布人名称" id="people" />
										</div>
									</div>
									<div class="fromboxs">
										<div class="from-left">
											内&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;容：
										</div>
										<div class="from-right">
											<textarea id="editor" type="text/plain" style="width:90%;height:300px;"></textarea>
										</div>
									</div>
									<div class="click">
										<button class="btn save" onclick="addBanner()">提交</button>
										<button class="btn back" onclick="window.location.href='/Index/index?liNumber=0';">返回</button>
									</div>
								</div>
								<!--box-left结束-->

								<!--box-right开始-->
								<div class="boxs-right boxs">
									<p style="margin-left: 13px;">文章预览（预览模式模拟手机型号为iPhone6）</p>
									<div class="img-content">
										<div  class="contentbox">
											<div id="book-a" class="book-a book"></div>
											<div id="people-a" class="book-a"></div>
											<div id="content-a" class="content-a"></div>
										</div>

									</div>
								</div>
							</div>
							<!--boxs内容结束-->
						</div>
					</div>
					<!--内容结束-->
					<!--分页开始-->
					<div id="demo" class="demo"></div>
				</div>
				<#include "/common/footer.html"/>
			</div>
	   </div>
	</body>

</html>

<script>
    function look(){
        // 上传图片点击放大
        $(".layui-upload-list").find("img").imgZoom();
    }
    //富文本初始化
    let ueditor_config = {
        autoHeightEnabled: false
    };
    var ue = UE.getEditor('editor',ueditor_config);

	//input预览功能
	//文章标题
	book = document.getElementById('book');
	booka = document.getElementById('book-a');
	//发布人
	people = document.getElementById('people');
	peoplea = document.getElementById('people-a');
	//内容
	content = document.getElementById('editor');
	contenta = document.getElementById('content-a');
	book.onchange = function() {
		val = book.value;
		booka.innerHTML = val;
	};
	people.onchange = function() {
		val = people.value;
		peoplea.innerHTML = val;
	};
    ue.addListener("selectionchange",function(){
        contenta.innerHTML = ue.getContent();

    })
    UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;
    UE.Editor.prototype.getActionUrl = function(action) {
        if (action == 'uploadimage' || action == 'uploadscrawl' || action == 'uploadimage' || action == 'uploadvideo' ) {
            return '/uploadimage';//指定访问路径
        }if (action == 'catchimage'){
            return "/ueditor?_csrf={{ ctx.csrf | safe }}";
        } else {
            return this._bkGetActionUrl.call(this, action);
        }
    }
	function getUrlParam(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) return r[2];
		return "";
	}
    var list = [];
    layui.use('upload', function() {
        var $ = layui.jquery,
            upload = layui.upload;
        //多图片上传
        upload.render({
            elem: '#test2',
            url: '/banners/uploadBanner',
            before: function(obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    $('#demo2').html('<img src="' + result + '" onclick=\'look()\' alt="" class="layui-upload-img">')
                });

            },
            done: function(res) {
                //上传完毕
                console.log("图片地址"+res.data);
                list = [];
                list.push(res.data);
            }
        });
	});

	//提交banner
	function addBanner(){
        var content = ue.getContent();
        var author =$("#people").val();
        var title =$("#book").val();
        var name =$("#name").val();
        var openState =$("input[name='radioInline']:checked").val();
        var imgBase64 = list.toString();
        if(imgBase64==""){
            return layer.msg("图片不能为空!");
        }
		var a =getUrlParam("type")
        $.ajax({
            url: "/banners/addBanner",
            type: "post",
            data: {
                "content": content,
                "author": author,
                "title": title,
                "name": name,
                "openState": openState,
                "path": path,
				"type":a
            },
            success: function (result) {
                console.log(result)
                if (result.success){
                    layer.msg("添加成功!");
                    if(a===1){
						window.location.href = "../robot?liNumber=0";
					}else {
						window.location.href="/Index/index?liNumber=0";
					}
                }else{
                    layer.msg("修改失败!");
                }
            }
        })
    }
</script>