<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>客户账号管理-客户权限管理</title>
    <link rel="stylesheet" href="/vonder/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/vonder/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/vonder/font_7grt4on8i7d/iconfont.css" media="all">
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/model.css"/>
    <link rel="stylesheet" href="/css/zone.css"/>
    <link rel="stylesheet" href="/css/delete.css"/>
    <link rel="stylesheet" href="/css/customer.css"/>

    <script src="/vonder/jquery-1.10.2/jquery-1.10.2.min.js"></script>
    <script src="/vonder/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="/vonder/layui/layui.js"></script>
    <script type="text/javascript" src="/js/common.js"></script>

    <!--bootstrap CheckBox美化-->
<!--    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
    <link rel="stylesheet" type="text/css" href="/css/build.css"/>

    <link rel="stylesheet" type="text/css" href="/vonder/select-search/jquery.searchableSelect.css"/>
    <script src="/select-search/jquery.searchableSelect.js"></script>

    <!--提示框-->
    <link rel="stylesheet" type="text/css" href="/css/zebra_tooltips.css"/>
    <script src="/js/zebra_tooltips.js"></script>
</head>
<style>
    input {
        outline: none !important;
    }
</style>
<body>
<!--头-->
<#include "../common/header.html"/>
<div class="wrapper ">
    <div class="content">
        <!--左侧开始-->
        <#include "../common/menu.html"/>

        <!--右侧开始-->
        <div class="content-right">
            <!--地域管理——内容-->
            <div>
                <ul class="customer-ul">
                    <li>客户账号管理</li>
                </ul>
                <div class="customer-box">
                    <div class="fromboxs">
                        <div class="from-left">
                            管理员账号：
                        </div>
                        <div class="from-right">
                            <input type="text" placeholder="请输入用户账号" autocomplete="off" id="text_userName"/>
                        </div>
                    </div>
                    <div class="fromboxs">
                        <div class="from-left">
                            密码：
                        </div>
                        <div class="from-right">
                            <input type="password" placeholder="请输入密码" autocomplete="new-password" id="text_passWord"/>
                        </div>
                    </div>
                    <div class="fromboxs select-search">
                        <div class="from-left">
                            机构名称：
                        </div>
                        <div class="from-right">
                            <select id="select_company">
                                <option value="">请选择机构</option>
                            </select>
                            <!--信息提示框-->
                            <a href="#" class="zebra_tips1" title="提示：所在地请谨慎选择，一经选择不可修改"><img
                                    src="/images/img/tishi.png" alt=""/></a>
                        </div>
                    </div>
                    <div class="fromboxs">
                        <div class="from-left">
                            有效时间：
                        </div>
                        <div class="from-right">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="text" class="layui-input" id="test1"
                                           placeholder="请选择用户有效时间">
                                    <img src="/images/img/data.png"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="fromboxs">
                        <div class="from-left">
                            是否允许上级单位查看：
                        </div>
                        <div class="radio radio-primary" style="margin-left: 12%;">
                            <div style="margin-right: 20px;float: left;width: 50px;">
                                <input id="radio1" class="" type="radio" value="0"
                                       name="isAllow" style="outline: none" checked onclick="hiddenDate(this)">
                                <label for="radio1">
                                    否
                                </label>
                            </div>
                            <div>
                                <input id="radio2" class="" type="radio" value="1"
                                       name="isAllow" style="outline: none" onclick="hiddenDate(this)">
                                <label for="radio2">
                                    是
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="fromboxs" id="hidden_date" hidden="hidden">
                        <div class="from-left">
                            允许查看时间：
                        </div>
                        <div class="from-right">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="text" class="layui-input" id="test2"
                                           placeholder="请选择允许查看时间">
                                    <img src="/images/img/data.png"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="fromboxs">
                        <div class="from-left">
                            备注：
                        </div>
                        <div class="from-right">
                            <textarea placeholder="请输入备注信息" id="remarks"></textarea>
                        </div>
                    </div>
                    <div class="fromboxs">
                        <div class="from-left">
                            权限管理：
                        </div>
                        <div class="from-right">
                            <div class="peizhi">
                                <table class="table table-bordered table-hover table-box" id="press_table">
                                    <thead>
                                    <tr class="beijing">
                                        <th>权限</th>
                                        <th colspan="3">权限配置</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="leftpz">群众举报</td>
                                        <td class="rightpz" colspan="3">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox1" class="styled" type="checkbox" value="10101"
                                                       name="press_check">
                                                <label for="checkbox1">
                                                    查看
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox2" class="styled" type="checkbox" value="10102"
                                                       name="press_check">
                                                <label for="checkbox2">
                                                    办理
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="leftpz">线索核查</td>
                                        <td class="rightpz" colspan="3">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox3" class="styled" type="checkbox" value="10201"
                                                       name="press_check">
                                                <label for="checkbox3">
                                                    查看
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox4" class="styled" type="checkbox" value="10202"
                                                       name="press_check">
                                                <label for="checkbox4">
                                                    办理
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="leftpz">数据统计</td>
                                        <td class="rightpz" colspan="3">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox5" class="styled" type="checkbox" value="10301"
                                                       name="press_check">
                                                <label for="checkbox5">
                                                    查看
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="leftpz" rowspan="4" style="vertical-align: middle;">办公应用</td>
                                        <td colspan="2">小程序管理</td>
                                        <td class="rightpz">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox6" class="styled" type="checkbox" value="10401"
                                                       name="press_check">
                                                <label for="checkbox6">
                                                    banner设置
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox7" class="styled" type="checkbox" value="10402"
                                                       name="press_check">
                                                <label for="checkbox7">
                                                    公告设置
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox18" class="styled" type="checkbox" value="10408"
                                                       name="press_check">
                                                <label for="checkbox18">
                                                    举报指引设置
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox8" class="styled" type="checkbox" value="10403"
                                                       name="press_check">
                                                <label for="checkbox8">
                                                    举报模块设置
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="td">舆情专报</td>
                                        <td class="rightpz">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox9" class="styled" type="checkbox" value="10404"
                                                       name="press_check">
                                                <label for="checkbox9">
                                                    查看
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox10" class="styled" type="checkbox" value="10405"
                                                       name="press_check">
                                                <label for="checkbox10">
                                                    管理(上传和删除)
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="td">法律法规</td>
                                        <td class="rightpz">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox11" class="styled" type="checkbox" value="10406"
                                                       name="press_check">
                                                <label for="checkbox11">
                                                    查看
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="td">案例库</td>
                                        <td class="rightpz">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox12" class="styled" type="checkbox" value="10407"
                                                       name="press_check">
                                                <label for="checkbox12">
                                                    查看
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="leftpz">配置管理</td>
                                        <td class="rightpz" colspan="3">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox13" class="styled" type="checkbox" value="10501"
                                                       name="press_check">
                                                <label for="checkbox1">
                                                    用户管理
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox14" class="styled" type="checkbox" value="10502"
                                                       name="press_check">
                                                <label for="checkbox14">
                                                    角色管理
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="leftpz">个人中心</td>
                                        <td class="rightpz" colspan="3">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox15" class="styled" type="checkbox" value="10601"
                                                       name="press_check">
                                                <label for="checkbox15">
                                                    修改密码
                                                </label>
                                            </div>
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox16" class="styled" type="checkbox" value="10602"
                                                       name="press_check">
                                                <label for="checkbox16">
                                                    主页设置
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="click">
                    <button class="btn save" onclick="saveUser()">保存</button>
                    <button class="btn off">取消</button>
                </div>
            </div>
        </div>

    </div>
</div>
<#include "../common/footer.html"/>
</body>
</html>
<script>

    $("#li_dygl").attr("class", "actives");

    $(".off").click(function () {
        window.location.href = "accountManger"
    });

    //提示框
    $(document).ready(function () {
        new $.Zebra_Tooltips($('.zebra_tips1'));
    });

    $(".return").click(function () {
        window.location.href = "logout"
    });

    if (getUrlParam("id") === "") {
        layui.use('laydate', function () {
            var laydate = layui.laydate;
            //日期范围
            laydate.render({
                elem: '#test1',
                range: "~"
            });
            laydate.render({
                elem: '#test2',
                range: "~"
            });
        });
    }

    initCompany();

    function initCompany() {

        $.post("/apis/procuratorate/findAll", function (result) {
            if (result.success) {
                var optionStr = "<option value='0'>请选择用户所在单位</option>";
                $(result.data).each(function (i, obj) {
                    optionStr += "<option value='" + obj.id + "'>" + obj.name + "</option>"
                });
                $("#select_company").html(optionStr);
                if (getUrlParam("id") === "") {
                    $('select').searchableSelect();
                }
            }
        })
    }

    function saveUser() {

        var startTime = "";
        var endTime = "";

        if ($("#test").val() !== "") {
            startTime = $("#test1").val().split("~")[0];
            endTime = $("#test1").val().split("~")[1];
        } else {
            alert("操作失败,请选择用户的有效期时间!!!");
            return false;
        }
        var companyId = $("#select_company").val();
        if (companyId === "" || companyId === 0) {
            alert("操作失败,选择检察院单位");
            return false;
        }

        var userName = $("#text_userName").val();
        var passWord = $("#text_passWord").val();
        var remarks = $("#remarks").val();
        var id = getUrlParam("id");
        var pressArr = "";

        var isAllow = $("input[name='isAllow']:checked").val();
        var allow_startTime = "";
        var allow_endTime = "";

        if (isAllow =="1"){
            if ($("#test2").val() !== "" ) {
                allow_startTime = $("#test2").val().split("~")[0];
                allow_endTime = $("#test2").val().split("~")[1];
            } else {
                alert("操作失败,请选择用户的有效期时间!!!");
                return false;
            }
        }

        $("input[name='press_check']:checked").each(function (i, obj) {
            pressArr += ($(obj).val() + ",");
        });
        $.post("/apis/user/saveUser", {
            id: id,
            userName: userName,
            companyId: companyId,
            password: passWord,
            remarks: remarks,
            pressList: pressArr,
            startTime: startTime,
            endTime: endTime,
            isAllow: isAllow,
            allowStartTime: allow_startTime,
            allowEndTime: allow_endTime
        }, function (result) {
            if (result.success) {
                window.location.href = "/accountManger";
            } else {
                alert(result.msg)
            }
        });
    }

    initUser();

    function initUser() {
        var id = getUrlParam("id");
        if (id != null && id !== "") {
            $.post("/apis/user/findById", {id: id}, function (result) {
                if (result.success) {
                    $("#text_userName").val(result.data.userName);
                    $("#text_passWord").val(result.data.password);
                    $("#remarks").val(result.data.remarks);
                    $("#select_company").val(result.data.companyId);
                    layui.use('laydate', function () {
                        var laydate = layui.laydate;
                        //日期范围
                        laydate.render({
                            elem: '#test1',
                            range: "~",
                            value: result.data.startTime + " ~ " + result.data.endTime
                        });
                        if (result.data.allowStartTime != null && result.data.allowStartTime !== "") {
                            laydate.render({
                                elem: '#test2',
                                range: "~",
                                value: result.data.allowStartTime + " ~ " + result.data.allowEndTime
                            });
                        } else {
                            laydate.render({
                                elem: '#test2',
                                range: "~"
                            });
                        }
                    });
                    $('select').searchableSelect();
                    $(result.data.pressStr.split(",")).each(function (i, obj) {
                        $("input[value=" + obj + "]").attr("checked", "checked");
                    });

                    $("input[value=" + result.data.isAllow + "]").attr("checked", "checked");
                    if (result.data.isAllow == 1) {
                        $("#hidden_date").show();
                    }
                }
            })
        }
    }

    function hiddenDate(obj) {
        if ($(obj).val() === "1") {
            $("#hidden_date").show();
        } else {
            $("#hidden_date").hide();
        }
    }

    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return r[2];
        return "";
    }


</script>